/* 1.2.1 2021-04-23 18:14:05 */
"use strict";function convertToMP3(t){for(var e,a,s=new lamejs.Mp3Encoder(t.numberC,t.sampleR,t.kbps),n=[],r=getDataAsInt16Array(t.leftData),o=getDataAsInt16Array(t.rightData),g=Math.floor(t.lng/576/40),i=g,l=0,v=0;l<t.lng;l+=576,v++){v>i&&(i+=g,postMessage({type:"msg",val:"mp3 DATA en cours"})),e=r.subarray(l,l+576),a=o.subarray(l,l+576),(p=s.encodeBuffer(e,a)).length>0&&n.push(p)}var p;(p=s.flush()).length>0&&n.push(p),postMessage({type:"data",val:n})}function getDataAsInt16Array(t){for(var e,a,s=t,n=s.length,r=0,o=new Int16Array(n);r<n;)o[r]=(e=s[r++],void 0,a=e<0?32768*e:32767*e,Math.max(-32768,Math.min(32768,a)));return o}function convertToWAV(t,e){e=e||{};var a=t.numberC,s=t.sampleR,n=e.float32?3:1,r=3===n?32:16,o=encodeWAV(2===a?interleave(t.leftData,t.rightData):t.leftData,n,s,a,r);postMessage({type:"data",val:o})}function encodeWAV(t,e,a,s,n){var r=n/8,o=s*r,g=new ArrayBuffer(44+t.length*r),i=new DataView(g);return writeString(i,0,"RIFF"),i.setUint32(4,36+t.length*r,!0),postMessage({type:"msg",val:"wav DATA en cours"}),writeString(i,8,"WAVE"),postMessage({type:"msg",val:"wav DATA en cours"}),writeString(i,12,"fmt "),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint32(16,16,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint16(20,e,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint16(22,s,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint32(24,a,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint32(28,a*o,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint16(32,o,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint16(34,n,!0),writeString(i,36,"data"),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint32(40,t.length*r,!0),1===e?floatTo16BitPCM(i,44,t):writeFloat32(i,44,t),g}function interleave(t,e){for(var a=t.length+e.length,s=new Float32Array(a),n=0,r=0;n<a;)s[n++]=t[r],s[n++]=e[r],r++;return s}function writeFloat32(t,e,a){for(var s=0;s<a.length;s++,e+=4)t.setFloat32(e,a[s],!0)}function floatTo16BitPCM(t,e,a){for(var s=0;s<a.length;s++,e+=2){var n=Math.max(-1,Math.min(1,a[s]));t.setInt16(e,n<0?32768*n:32767*n,!0)}}function writeString(t,e,a){for(var s=0;s<a.length;s++)t.setUint8(e+s,a.charCodeAt(s))}"undefined"==typeof window&&importScripts("./libs/lame.min.js"),onmessage=function(t){var e=t.data[0];"mp3"==e.typeToExport?convertToMP3(e):convertToWAV(e)},this.log=console.log;